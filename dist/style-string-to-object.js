import './lodash-es/_listCacheClear.js-e2c31d6d.js';
import './lodash-es/eq.js-3067b71d.js';
import './lodash-es/_assocIndexOf.js-9d262dc0.js';
import './lodash-es/_listCacheDelete.js-73448065.js';
import './lodash-es/_listCacheGet.js-ab0a3256.js';
import './lodash-es/_listCacheHas.js-3166b85c.js';
import './lodash-es/_listCacheSet.js-de9e7743.js';
import './lodash-es/_ListCache.js-31797373.js';
import './lodash-es/_stackClear.js-583ff074.js';
import './lodash-es/_stackDelete.js-51c69537.js';
import './lodash-es/_stackGet.js-4846d0cd.js';
import './lodash-es/_stackHas.js-65485a5c.js';
import './lodash-es/_freeGlobal.js-ac63e052.js';
import './lodash-es/_root.js-82806f10.js';
import './lodash-es/_Symbol.js-09c49294.js';
import './lodash-es/_getRawTag.js-f59ed6e5.js';
import './lodash-es/_objectToString.js-57a29940.js';
import './lodash-es/_baseGetTag.js-f3ef6f41.js';
import './lodash-es/isObject.js-52553cde.js';
import './lodash-es/isFunction.js-e7b830c1.js';
import './lodash-es/_coreJsData.js-d0cf551e.js';
import './lodash-es/_isMasked.js-67721d8e.js';
import './lodash-es/_toSource.js-b768b872.js';
import './lodash-es/_baseIsNative.js-c2ce2406.js';
import './lodash-es/_getValue.js-18c9d5bc.js';
import './lodash-es/_getNative.js-6ce67c8b.js';
import './lodash-es/_Map.js-26262f48.js';
import './lodash-es/_nativeCreate.js-478e8045.js';
import './lodash-es/_hashClear.js-6690e721.js';
import './lodash-es/_hashDelete.js-5fa65fee.js';
import './lodash-es/_hashGet.js-73445d8e.js';
import './lodash-es/_hashHas.js-896bca19.js';
import './lodash-es/_hashSet.js-7b0463bb.js';
import './lodash-es/_Hash.js-f6717b1a.js';
import './lodash-es/_mapCacheClear.js-10156fde.js';
import './lodash-es/_isKeyable.js-a6bd7f34.js';
import './lodash-es/_getMapData.js-6312c74c.js';
import './lodash-es/_mapCacheDelete.js-01a46502.js';
import './lodash-es/_mapCacheGet.js-42005c75.js';
import './lodash-es/_mapCacheHas.js-0989f7fc.js';
import './lodash-es/_mapCacheSet.js-15b69a11.js';
import './lodash-es/_MapCache.js-0e911fa6.js';
import './lodash-es/_stackSet.js-565499c9.js';
import './lodash-es/_Stack.js-283d3e23.js';
import './lodash-es/_defineProperty.js-3ce473e1.js';
import './lodash-es/_baseAssignValue.js-e6945a61.js';
import './lodash-es/_assignMergeValue.js-4893b41f.js';
import './lodash-es/_createBaseFor.js-41ed5751.js';
import './lodash-es/_baseFor.js-abbb37ca.js';
import './lodash-es/_cloneBuffer.js-fda27ee5.js';
import './lodash-es/_Uint8Array.js-8616f24c.js';
import './lodash-es/_cloneArrayBuffer.js-5068fcff.js';
import './lodash-es/_cloneTypedArray.js-cdcdcc65.js';
import './lodash-es/_copyArray.js-60683993.js';
import './lodash-es/_baseCreate.js-1fe7d114.js';
import './lodash-es/_overArg.js-a472e8ea.js';
import './lodash-es/_getPrototype.js-30d5af28.js';
import './lodash-es/_isPrototype.js-28e760ef.js';
import './lodash-es/_initCloneObject.js-451623ee.js';
import './lodash-es/isObjectLike.js-bf43cd33.js';
import './lodash-es/_baseIsArguments.js-ea906a63.js';
import './lodash-es/isArguments.js-49778255.js';
import './lodash-es/isArray.js-348c388d.js';
import './lodash-es/isLength.js-0b7b9fd1.js';
import './lodash-es/isArrayLike.js-a791d85f.js';
import './lodash-es/isArrayLikeObject.js-9ec94c2e.js';
import './lodash-es/stubFalse.js-2cdba8d4.js';
import './lodash-es/isBuffer.js-b51562a3.js';
import './lodash-es/isPlainObject.js-f82871af.js';
import './lodash-es/_baseIsTypedArray.js-94c2af13.js';
import './lodash-es/_baseUnary.js-6df1a89e.js';
import './lodash-es/_nodeUtil.js-62848496.js';
import './lodash-es/isTypedArray.js-5ad2fd2e.js';
import './lodash-es/_safeGet.js-477e482b.js';
import './lodash-es/_assignValue.js-85b1adb0.js';
import './lodash-es/_copyObject.js-85710492.js';
import './lodash-es/_baseTimes.js-7e32212b.js';
import './lodash-es/_isIndex.js-75de89e7.js';
import './lodash-es/_arrayLikeKeys.js-9d4926bb.js';
import './lodash-es/_nativeKeysIn.js-11dd4ac3.js';
import './lodash-es/_baseKeysIn.js-94b39114.js';
import './lodash-es/keysIn.js-a456e211.js';
import './lodash-es/toPlainObject.js-abc6a198.js';
import './lodash-es/_baseMergeDeep.js-9ff81186.js';
import './lodash-es/_baseMerge.js-94b3d7a7.js';
import './lodash-es/identity.js-ddb76187.js';
import './lodash-es/_apply.js-367f18b6.js';
import './lodash-es/_overRest.js-96a11039.js';
import './lodash-es/constant.js-f1c147da.js';
import './lodash-es/_baseSetToString.js-0f32ff52.js';
import './lodash-es/_shortOut.js-db5b33fd.js';
import './lodash-es/_setToString.js-b1e00eb2.js';
import './lodash-es/_baseRest.js-7e6e80dd.js';
import './lodash-es/_isIterateeCall.js-2264efb2.js';
import './lodash-es/_createAssigner.js-9c754eed.js';
import { m as merge } from './lodash-es/merge.js-442025fa.js';
import './lodash-es/isSymbol.js-2b98fa01.js';
import './lodash-es/_isKey.js-20c1b706.js';
import './lodash-es/memoize.js-169583e3.js';
import './lodash-es/_memoizeCapped.js-497b94a3.js';
import './lodash-es/_stringToPath.js-14426231.js';
import './lodash-es/_arrayMap.js-efbe07df.js';
import './lodash-es/_baseToString.js-2c117502.js';
import './lodash-es/toString.js-054ab19d.js';
import './lodash-es/_castPath.js-23467a97.js';
import './lodash-es/_toKey.js-00bd10e9.js';
import './lodash-es/_baseSet.js-1e97817a.js';
import './lodash-es/_arrayEvery.js-93f9a99b.js';
import './lodash-es/_setCacheAdd.js-6cf11f54.js';
import './lodash-es/_setCacheHas.js-077b149c.js';
import './lodash-es/_SetCache.js-92df99dc.js';
import './lodash-es/_arraySome.js-648bb11f.js';
import './lodash-es/_cacheHas.js-aa223a23.js';
import './lodash-es/_equalArrays.js-15326ddd.js';
import './lodash-es/_mapToArray.js-1b7d050b.js';
import './lodash-es/_setToArray.js-daaaf907.js';
import './lodash-es/_equalByTag.js-5ebaad3d.js';
import './lodash-es/_arrayPush.js-6ac3b0b0.js';
import './lodash-es/_baseGetAllKeys.js-d353ff0c.js';
import './lodash-es/_arrayFilter.js-6c6cb9e4.js';
import './lodash-es/stubArray.js-a0b52c3f.js';
import './lodash-es/_getSymbols.js-aee7efbf.js';
import './lodash-es/_nativeKeys.js-3a24687a.js';
import './lodash-es/_baseKeys.js-a855521c.js';
import './lodash-es/keys.js-f4a95bd3.js';
import './lodash-es/_getAllKeys.js-0b0492cc.js';
import './lodash-es/_equalObjects.js-37b603d0.js';
import './lodash-es/_DataView.js-25495e22.js';
import './lodash-es/_Promise.js-222457f4.js';
import './lodash-es/_Set.js-0d56afa2.js';
import './lodash-es/_WeakMap.js-ad7381a2.js';
import './lodash-es/_getTag.js-9cc934cc.js';
import './lodash-es/_baseIsEqualDeep.js-05ed3446.js';
import './lodash-es/_baseIsEqual.js-2081c9b2.js';
import './lodash-es/_baseIsMatch.js-fe8d464f.js';
import './lodash-es/_isStrictComparable.js-a9828370.js';
import './lodash-es/_getMatchData.js-8a722ba0.js';
import './lodash-es/_matchesStrictComparable.js-d19af892.js';
import './lodash-es/_baseMatches.js-39913338.js';
import './lodash-es/_baseGet.js-a279f2a7.js';
import './lodash-es/get.js-addb1d30.js';
import './lodash-es/_baseHasIn.js-5eb272a4.js';
import './lodash-es/_hasPath.js-cb394a0c.js';
import './lodash-es/hasIn.js-2f0ad596.js';
import './lodash-es/_baseMatchesProperty.js-5334e4c8.js';
import './lodash-es/_baseProperty.js-00c82e77.js';
import './lodash-es/_basePropertyDeep.js-e8318885.js';
import './lodash-es/property.js-ddd8f638.js';
import './lodash-es/_baseIteratee.js-718e1a1e.js';
import './lodash-es/_isFlattenable.js-8ef4abd2.js';
import './lodash-es/_baseFlatten.js-8b85ebbc.js';
import './lodash-es/flatten.js-06038df6.js';
import './lodash-es/_flatRest.js-d229910c.js';
import './lodash-es/_createOver.js-5e666ff5.js';
import './lodash-es/overEvery.js-85c2260f.js';
import './lodash-es/overSome.js-2ada7e25.js';
import './lodash-es/_baseForOwn.js-f2105544.js';
import './lodash-es/_createBaseEach.js-2bcc6476.js';
import './lodash-es/_baseEach.js-f31c688f.js';
import './lodash-es/_baseMap.js-781eedcf.js';
import './lodash-es/_baseSortBy.js-2eea9fb7.js';
import './lodash-es/_compareAscending.js-b327f9ec.js';
import './lodash-es/_compareMultiple.js-4ef115e3.js';
import './lodash-es/_baseOrderBy.js-1c53f017.js';
import './lodash-es/sortBy.js-cfaf310e.js';
import './lodash-es/isString.js-650ac401.js';
import './lodash-es/_basePickBy.js-9e8e587d.js';
import './lodash-es/_basePick.js-4883a589.js';
import './lodash-es/pick.js-88ae7d68.js';
import './lodash-es/uniqueId.js-cdc34c97.js';
import { pipe } from './fp-utils.js';

const styleStringToObj = (()=>{
  const styleMatcher = /^([a-z]+)([A-Z0-9.:#+-]+)?(.*)$/;
  const valSetterFactory = fn=>(...keys)=>pipe(fn,sz=>keys.reduce((o,k)=>{o[k]=sz;return o;},{}));
  const parseColor = (num,unit)=>{
    if (num==='T') return 'transparent';
    if (num==='N') return 'none';
    if (num.length===1) return `#${num}${num}${num}`;
    if (num.length===2) return `#${num}${num[1]}`;
    if (num.length===3) return `#${num}`;
    if (num.length===6) return `#${num}`;
    return `${num}${unit}`;
  };
  const getSizeVal = (num,unit)=>`${num}${units[unit]}`;
  const getSizeObj = valSetterFactory(getSizeVal);
  const getColorObj = valSetterFactory(parseColor);
  const getGridTemplateVal = (num='A',unit)=>{
    if (num==='A') return 'auto';
    if (num==='M') return `minmax(${unit})`;
    if (num==='F') return `fit-content(${unit})`;
    if (num==='R') return `repeat(${unit})`;
    return `${num}${unit}`.replace(nestedSplitter,' ');
  };
  const parser = (str)=>{
    try{
      const [_,prefix,num,unit]=str.match(styleMatcher); // eslint-disable-line no-unused-vars
      return prefixes[prefix](num,unit)
    } catch(e){
      globalThis.console && console.warn(`invalid style: "${str}". See style-string-to-object.test.js for correct syntax.`);
      return {};
    }
  };

  const styleSeparator = ' ';
  const getCachedOrParseThenCache = (str)=>{
    if(str.raw) str=str.raw[0]; // handle tagged template strings e.g., s`w100px`;
    return cache[str]||(cache[str]=merge({},...str.split(styleSeparator).filter(s=>!!s).map(s=>cache[s]||(cache[s]=parser(s)))));
  };
  const parseNested = str=>styleStringToObj(str.replace(nestedSplitter,styleSeparator));
  const nestedSplitter = /_/g;
  const prefixes ={
    left:getSizeObj('left'),
    right:getSizeObj('right'),
    top:getSizeObj('top'),
    bottom:getSizeObj('bottom'),
    w:getSizeObj('width'),
    h:getSizeObj('height'),
    z:(num)=>({zIndex:num}),
    minw:getSizeObj('minWidth'),
    maxw:getSizeObj('maxWidth'),
    minh:getSizeObj('minHeight'),
    maxh:getSizeObj('maxHeight'),
    m:getSizeObj('marginTop','marginRight','marginBottom','marginLeft'),
    mt:getSizeObj('marginTop'),
    mr:getSizeObj('marginRight'),
    mb:getSizeObj('marginBottom'),
    ml:getSizeObj('marginLeft'),
    p:getSizeObj('paddingTop','paddingRight','paddingBottom','paddingLeft'),
    pt:getSizeObj('paddingTop'),
    pr:getSizeObj('paddingRight'),
    pb:getSizeObj('paddingBottom'),
    pl:getSizeObj('paddingLeft'),
    b:getSizeObj('borderTopWidth','borderRightWidth','borderBottomWidth','borderLeftWidth'),
    bt:getSizeObj('borderTopWidth'),
    br:getSizeObj('borderRightWidth'),
    bb:getSizeObj('borderBottomWidth'),
    bl:getSizeObj('borderLeftWidth'),
    bc:getColorObj('borderColor'),
    brad:getSizeObj('borderRadius'),
    lh:getSizeObj('lineHeight'),
    t:(num,unit)=>({fontSize:getSizeVal(num,unit),lineHeight:getSizeVal((+num+0.4).toFixed(1),unit)}),
    ts:(num,unit)=>({fontSize:getSizeVal(num,unit)}),
    tc:getColorObj('color'),//text color
    bg:getColorObj('backgroundColor'),//text color
    bgc:getColorObj('backgroundColor'),//text color
    op:(num,unit)=>({opacity:num}),
    // svg-specific
    fill:getColorObj('fill'),
    strk:getColorObj('stroke'),
    strkw:getSizeObj('strokeWidth'),
    strkdsh:getSizeObj('strokeDasharray'),
    transx:pipe(getSizeVal,sz=>({transform:`translateX(${sz})`})),
    transy:pipe(getSizeVal,sz=>({transform:`translateY(${sz})`})),
    gtc:(num,unit)=>({ display:'grid', gridTemplateColumns:getGridTemplateVal(num,unit)}),
    gtr:(num,unit)=>({ display:'grid', gridTemplateRows:getGridTemplateVal(num,unit)}),
    vl:(num,unit)=>({display:'grid', gridTemplateColumns:'100%',gridTemplateRows:getGridTemplateVal(num,unit)}),
    hl:(num,unit)=>({display:'grid', gridTemplateRows:'100%',gridTemplateColumns:getGridTemplateVal(num,unit)}),
    /* pseudoclasses: requires some lib (e.g., styletron) that converts styles to an actual stylesheet */
    nth:(num,unit)=>({[`:nth-child(${num})`]:parseNested(unit)}),
    // select = 6 nth6
    // select >=6 nthn1+6
    // select <=6 nthn-+6
    // select %2 nthn2
    // select odds nthn2-1
    // select every 4th,starting at 1 nthn4+1
    // select second to last (not implemented) nth-last-child(2)
    nthn:(num,unit)=>({[`:nth-child(${num[0]}n${num.slice(1)})`]:parseNested(unit)}),
    before:(num,unit)=>({':before':parseNested(unit)}),
    after:(num,unit)=>({':after':parseNested(unit)}),
    first:(num,unit)=>({':first-child':parseNested(unit)}),
    last:(num,unit)=>({':last-child':parseNested(unit)}),
    link:(num,unit)=>({':link':parseNested(unit)}),
    visited:(num,unit)=>({':visited':parseNested(unit)}),
    hover:(num,unit)=>({':hover':parseNested(unit)}),
    active:(num,unit)=>({':active':parseNested(unit)}),
    above:(num,unit)=>({[`@media (min-width: ${num-1}px)`]:parseNested(unit)}),
    below:(num,unit)=>({[`@media (max-width: ${num}px)`]:parseNested(unit)}),
  };
  const units={
    '':'%',
    '%':'%',
    e:'em',
    em:'em',
    p:'px',
    px:'px',
    f:'fr',
    c:'ch',

  };
  const cache = {
    // lists
    fInline:{display:'inline-flex'},
    fShrink0:{flexShrink:'0'},
    fGrow1:{flexGrow:'1'},
    fAIS:{alignItems:'flex-start'},
    fACS:{alignContent:'flex-start'},
    fAIC:{alignItems:'center'},
    fAIStretch:{alignItems:'stretch'},
    fACC:{alignContent:'center'},
    fAIE:{alignItems:'flex-end'},
    fACE:{alignContent:'flex-end'},
    fJCE:{justifyContent:'flex-end'},
    fJCS:{justifyContent:'flex-start'},
    fJCStretch:{justifyContent:'stretch'},
    fJCC:{justifyContent:'center'},
    fJCSA:{justifyContent:'space-around'},
    fJCSB:{justifyContent:'space-between'},
    fJCSE:{justifyContent:'space-evenly'},

    // borders
    bS:{borderStyle:'solid'},
    bD:{borderStyle:'dashed'},
    // text
    tSerif:{fontFamily: `serif`},
    tCapital:{textTransform:'capital'},
    tUpper:{textTransform:'uppercase'},
    tLower:{textTransform:'lowercase'},
    tUnderline:{textDecoration:'underline'},
    tItalic:{textDecoration:'italic'},
    tBold:{fontWeight:'700'},
    // vertical-align
    tvaM:{verticalAlign:'middle'},
    tvaT:{verticalAlign:'top'},
    tvaB:{verticalAlign:'bottom'},
    taC:{textAlign:'center'},
    taL:{textAlign:'left'},
    taR:{textAlign:'right'},
    // tSans from https://css-tricks.com/snippets/css/system-font-stack/
    tSans:{ fontFamily: `-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,`+
      `Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif`},
    // sizes
    wAuto:{width:`auto`},
    hAuto:{height:`auto`},
    mtAuto:{marginTop:`auto`},
    mrAuto:{marginRight:`auto`},
    mbAuto:{marginBottom:`auto`},
    mlAuto:{marginLeft:`auto`},
    mAuto:{marginTop:`auto`,marginRight:`auto`,marginBottom:`auto`,marginLeft:`auto`},
    mInherit:{marginTop:`inherit`,marginRight:`inherit`,marginBottom:`inherit`,marginLeft:`inherit`},
    wInherit:{width:`inherit`},
    hInherit:{height:`inherit`},
    mtInherit:{marginTop:`inherit`},
    mrInherit:{marginRight:`inherit`},
    mbInherit:{marginBottom:`inherit`},
    mlInherit:{marginLeft:`inherit`},


    // white-space
    wsN:{whiteSpace:'normal'},
    wsNW:{whiteSpace:'no-wrap'},
    wsPL:{whiteSpace:'pre-line'},
    wsP:{whiteSpace:'pre'},
    // word-break
    wbN:{wordBreak:'normal'},
    wbBA:{wordBreak:'break-all'},
    wbKA:{wordBreak:'keep-all'},
    wbBW:{wordBreak:'break-word'},
    // overflow-wrap
    owBW:{overflowWrap:'break-word'},
    owN:{overflowWrap:'normal'},
    // overflow
    oH:{overflow:'hidden'},
    oV:{overflow:'visible'},
    oS:{overflow:'scroll'},
    oA:{overflow:'auto'},
    oxH:{overflowX:'hidden'},
    oxV:{overflowX:'visible'},
    oxS:{overflowX:'scroll'},
    oxA:{overflowX:'auto'},
    oyH:{overflowY:'hidden'},
    oyV:{overflowY:'visible'},
    oyS:{overflowY:'scroll'},
    oyA:{overflowY:'auto'},
    // display
    dB:{display:'block'},
    dN:{display:'none'},
    dIF:{display:'inline-flex'},
    dI:{display:'inline'},
    dG:{display:'grid'},

    // visibility
    vV:{visibility:'visible'},
    vH:{visibility:'hidden'},
    // position
    posA:{position:'absolute'},
    posR:{position:'relative'},
    posF:{position:'fixed'},
    posS:{position:'sticky'},
    posStatic:{position:'static'},
    // cursor
    crP:{cursor:'pointer'},
    crD:{cursor:'default'},
    // pointer-events
    peN:{pointerEvents:'none',touchAction:'none'},
    // user-select
    usN:{userSelect:'none'},
    usT:{userSelect:'text'},
    usC:{userSelect:'contain'},
    usA:{userSelect:'all'},

  };
  cache.tLink = {
    ...cache.tUnderline,
    ':link':cache.tUnderline,
    ':visited':cache.tUnderline,
    ':hover':cache.tUnderline,
    ':active':cache.tUnderline,
  };

  cache.fh = {
    listStyleType:'none',
    display:'flex',
    flexDirection:'row',
    alignItems:'center',
    alignContent:'flex-start',
    justifyContent:'flex-start',
    flexWrap:'nowrap',
  };
  cache.fv = {
    ...cache.fh,
    flexDirection:'column',
    alignItems:'flex-start',
  };
  cache.fg = {
    ...cache.fh,
    flexWrap:'wrap',
    alignItems:'flex-start',
    justifyContent:'space-evenly',
  };

  cache.h = {
    display:'grid',
    gridTemplateColumns:'auto',
    alignItems:'center',
    alignContent:'flex-start',
    justifyContent:'flex-start',
    flexWrap:'nowrap',
  };
  cache.v = {
    ...cache.fh,
    flexDirection:'column',
    alignItems:'flex-start',
  };
  cache.g = {
    ...cache.fh,
    flexWrap:'wrap',
    alignItems:'flex-start',
    justifyContent:'space-evenly',
  };

  cache.fhi = {
    listStyleType:'none',
    flexGrow:'0',
    flexShrink:'1',
    flexBasis:'auto',
    width:'auto',
    height:'auto',
  };
  cache.fvi = {
    ...cache.fhi,
    flexShrink:'0',
  };
  cache.fgi = {
    ...cache.fhi,
  };


  return getCachedOrParseThenCache;
})();

export default styleStringToObj;
export { styleStringToObj };
